<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Chapter One</title>

<style>
:root {
  --bg1:#111;
  --bg2:#1c1c1c;
  --accent:#ff4d7d;
}

*{box-sizing:border-box;}

body{
  margin:0;
  min-height:100svh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background:linear-gradient(to bottom,var(--bg1),var(--bg2));
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  text-align:center;
  overflow:hidden;
}

.container{
  width:100%;
  max-width:700px;
  padding:24px;
}

h1{
  font-size:clamp(24px,6vw,36px);
  font-weight:600;
  margin-bottom:20px;
  opacity:0;
  animation:fadeIn 2s forwards;
}

button{
  padding:14px 26px;
  font-size:16px;
  font-weight:600;
  border:none;
  border-radius:999px;
  cursor:pointer;
  background:var(--accent);
  color:white;
  box-shadow:0 10px 30px rgba(255,77,125,.3);
}

button:hover{
  transform:scale(1.05);
}

.video-wrapper{
  display:none;
  position:fixed;
  inset:0;
  background:black;
  justify-content:center;
  align-items:center;
}

video{
  width:100%;
  height:100%;
  object-fit:cover;
}

.final-text{
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,.7);
  padding:30px;
  text-align:center;
  font-size:clamp(20px,5vw,32px);
  line-height:1.6;
  display:none;
}

.cursor{
  border-right:2px solid white;
  animation:blink 1s infinite;
}

@keyframes blink{
  0%,50%,100%{border-color:white;}
  25%,75%{border-color:transparent;}
}

@keyframes fadeIn{
  to{opacity:1;}
}
</style>
</head>

<body>

<div class="container" id="intro">
  <h1>
    January 1 â€” I decided to try.<br><br>
    January 11 â€” You said yes.<br><br>
    February 11 â€” One month with you.
  </h1>

  <button id="startBtn">Relive it with me</button>
</div>

<div class="video-wrapper" id="videoSection">
  <video id="memoryVideo" src="memory.mp4"></video>
</div>

<div class="final-text" id="finalText">
  <div id="typewriter"></div>
</div>

<audio id="bgMusic" src="song.mp3"></audio>

<script>
const startBtn = document.getElementById("startBtn");
const intro = document.getElementById("intro");
const videoSection = document.getElementById("videoSection");
const video = document.getElementById("memoryVideo");
const finalText = document.getElementById("finalText");
const typewriter = document.getElementById("typewriter");
const music = document.getElementById("bgMusic");

let hasTransitioned = false;

startBtn.onclick = () => {
  intro.style.display = "none";
  videoSection.style.display = "flex";

  music.volume = 0;
  music.play().catch(()=>{});

  // smooth fade in
  let vol = 0;
  const fade = setInterval(()=>{
    if(vol < 0.6){
      vol += 0.02;
      music.volume = vol;
    } else {
      clearInterval(fade);
    }
  },100);

  video.play();
};

// ðŸ”¥ Primary trigger
video.addEventListener("ended", triggerTransition);

// ðŸ”¥ Backup trigger for iOS weirdness
video.addEventListener("timeupdate", () => {
  if (!hasTransitioned && video.currentTime >= video.duration - 0.2) {
    triggerTransition();
  }
});

function triggerTransition() {
  if (hasTransitioned) return;
  hasTransitioned = true;

  // small delay to let iOS settle
  setTimeout(() => {
    video.pause();
    video.currentTime = 0;

    videoSection.style.opacity = "0";

    setTimeout(() => {
      videoSection.style.display = "none";
      finalText.style.display = "flex";

      // force repaint (iOS fix)
      void finalText.offsetHeight;

      startTypewriter();
    }, 300);

  }, 100);
}

function startTypewriter(){
  const textLines = [
    "Chapter One was beautiful.",
    "",
    "Can we write all the next chapters together?"
  ];

  let lineIndex = 0;
  let charIndex = 0;
  typewriter.innerHTML = "";

  function type(){
    if(lineIndex < textLines.length){
      if(charIndex < textLines[lineIndex].length){
        typewriter.innerHTML += textLines[lineIndex][charIndex];
        charIndex++;
        setTimeout(type, 50);
      } else {
        typewriter.innerHTML += "<br>";
        lineIndex++;
        charIndex = 0;
        setTimeout(type, 800);
      }
    }
  }

  type();
}
</script>

</body>
</html>
